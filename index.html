<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="utf-8" />
  <title>Prospect 3 â€” Interactive Flipbook</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark light">
  <style>
    :root{
      --bg:#0b1220; --card:#121a2d; --accent:#71d7ff; --accent2:#13d38b; --text:#e9f1ff; --muted:#9bb3cc;
      --glow:0 0 12px rgba(19,211,139,.6), 0 0 24px rgba(19,211,139,.3);
      --grad1:#1f3663; --grad2:#16274b;
    }
    *{box-sizing:border-box}
    html,body{
      margin:0;padding:0;background:radial-gradient(1200px 600px at 20% 10%, #0f1830 0%, #0b1220 50%, #091024 100%);
      color:var(--text);font-family:Inter,system-ui,Segoe UI,Arial;
    }
    button{cursor:pointer}

    .topbar{
      position:sticky;top:0;z-index:10;height:60px;background:#0b1220cc;backdrop-filter: blur(6px);
      display:flex;align-items:center;justify-content:space-between;padding:0 16px;border-bottom:1px solid #203055;
    }
    .brand-title{font-weight:700;letter-spacing:.4px}
    .left-controls,.right-controls{display:flex;gap:8px}

    .btn{
      border:none;padding:10px 14px;border-radius:12px;color:#fff;background:#1c2745;
      transition:transform .15s, box-shadow .15s, background .2s, filter .2s;
    }
    .btn:hover{transform:translateY(-1px);box-shadow:0 6px 18px rgba(0,0,0,.25);filter:brightness(1.06)}
    .outline-btn{background:transparent;border:1px solid #2f4577}
    .glow-btn{background:linear-gradient(90deg,#13d38b,#71d7ff);color:#06233a;font-weight:700;box-shadow:var(--glow)}
    .gradient-btn{background:linear-gradient(120deg,#1d6bff,#13d38b);color:#021427;font-weight:700}
    .small{padding:6px 10px;border-radius:8px}

    .start-screen{min-height:calc(100vh - 60px);display:flex;align-items:center;justify-content:center;padding:24px}
    .start-card{
      width:min(1100px,95vw);background:linear-gradient(160deg,#10192f 0%, #0d1630 50%, #0b1429 100%);
      border:1px solid #23365f;box-shadow:0 20px 50px rgba(0,0,0,.35);border-radius:22px;padding:28px;position:relative;overflow:hidden;
      animation:slideIn .6s ease-out both;
    }
    @keyframes slideIn{from{transform:translateY(12px);opacity:.0}to{transform:translateY(0);opacity:1}}

    .hero{display:flex;align-items:center;justify-content:space-between;gap:16px}
    .hero-title .title{font-size:2.3rem;margin:0 0 8px}
    .subtitle{color:var(--muted);margin:0 0 12px}
    .hero-visual{position:relative;width:220px;height:120px}
    .orb{position:absolute;border-radius:50%;filter:blur(10px);opacity:.65}
    .orb1{width:90px;height:90px;background:#13d38b;top:8px;left:18px;animation:float1 6s ease-in-out infinite}
    .orb2{width:70px;height:70px;background:#71d7ff;top:26px;left:110px;animation:float2 7s ease-in-out infinite}
    .orb3{width:60px;height:60px;background:#eeaaff;top:70px;left:50px;animation:float3 8s ease-in-out infinite}
    @keyframes float1{0%{transform:translateY(0)}50%{transform:translateY(-8px)}100%{transform:translateY(0)}}
    @keyframes float2{0%{transform:translateY(0)}50%{transform:translateY(10px)}100%{transform:translateY(0)}}
    @keyframes float3{0%{transform:translateY(0)}50%{transform:translateY(-6px)}100%{transform:translateY(0)}}

    .designer-bar{
      display:flex;align-items:center;gap:12px;padding:10px;border-radius:14px;margin-top:10px;
      background:linear-gradient(90deg,rgba(19,211,139,.10),rgba(113,215,255,.08));border:1px solid #2a455f;
      box-shadow:0 0 16px rgba(19,211,139,.15);
    }
    .designer-photo{width:64px;height:64px;border-radius:50%;object-fit:cover;border:2px solid #2a455f}
    .designer-meta .designer-name{font-size:.95rem;color:#9bd6ff}
    .designer-meta .designer-id{font-size:.9rem;color:#bde8ff}
    .section-head{margin:18px 0 8px 0;color:#cfe7ff;font-size:1.2rem}

    .lesson-grid,.exam-grid,.tools-grid{display:grid;gap:12px;margin-top:10px}
    .lesson-grid{grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
    .exam-grid{grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
    .tools-grid{grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}
    .lesson-btn,.exam-btn{
      border:none;padding:16px;border-radius:16px;font-weight:700;letter-spacing:.3px;
      background:linear-gradient(120deg,var(--grad1),var(--grad2));color:#dff3ff;border:1px solid #2f4577;
      display:flex;align-items:center;justify-content:space-between;transition:transform .15s, box-shadow .15s, background .2s;
    }
    .lesson-btn span{font-size:1.1rem}
    .lesson-btn small{color:#9bb3cc}
    .lesson-btn:hover,.exam-btn:hover{transform:translateY(-2px);box-shadow:0 10px 24px rgba(0,0,0,.35)}
    .pulse{animation:pulse 2.5s infinite}
    .glow{box-shadow:0 0 16px rgba(113,215,255,.25),0 0 32px rgba(19,211,139,.15)}
    @keyframes pulse{0%{box-shadow:0 0 0 0 rgba(113,215,255,.7)}70%{box-shadow:0 0 0 20px rgba(113,215,255,0)}100%{box-shadow:0 0 0 0 rgba(113,215,255,0)}}

    .hidden{display:none}

    .flipbook-nav{display:flex;align-items:center;justify-content:space-between;padding:10px 16px}
    .nav-btn{font-size:20px;width:44px;height:44px;border-radius:12px}
    .current-title{font-weight:700;color:#cfe7ff}

    .flipbook{perspective:1500px;position:relative;width:min(1100px,96vw);margin:0 auto}
    .page{
      background:linear-gradient(180deg,#111b32,#0d162c);
      border:1px solid #2d426b;border-radius:16px;width:100%;min-height:68vh;margin:18px 0;padding:18px;
      box-shadow:0 30px 60px rgba(0,0,0,.35);transform-origin:left center;transition:transform .7s ease, box-shadow .4s ease, opacity .4s ease;
    }
    .page h2{margin-top:0;color:#cfe7ff;border-bottom:1px solid #253a65;padding-bottom:6px}
    .page-turn-enter{transform:rotateY(-180deg);box-shadow:0 20px 40px rgba(19,211,139,.25);opacity:1}
    .page-turn-leave{transform:rotateY(180deg);opacity:.0}

    .section{margin:12px 0 20px;padding:12px;border:1px dashed #2f4577;border-radius:12px}
    .section h3{margin:0 0 8px;color:#9bd6ff}
    .section .text{line-height:1.85;color:#e4f0ff}

    .word{cursor:pointer;border-bottom:1px dashed #2f4577}
    .word:hover{color:#71d7ff}

    .exercise-item{padding:8px;border-radius:10px;background:#0f1a32;border:1px solid #2a4068;margin-bottom:8px}
    .exercise-controls{display:flex;gap:10px;margin-top:8px;flex-wrap:wrap}
    .answer-key{display:none;margin-top:6px;color:#bde8ff}
    .answer-key.show{display:block}
    .correct{outline:2px solid #13d38b}
    .incorrect{outline:2px solid #ff6e6e}

    .photo-dict-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px;margin-top:10px}
    .phrase-card{background:#0f1a32;border:1px solid #2a4068;border-radius:12px;padding:12px}
    .phrase-actions{display:flex;gap:8px;margin-top:8px}

    .designer-footer{margin:24px 16px}

    .modal{
      position:fixed;inset:0;background:rgba(6,12,24,.6);
      display:flex;align-items:center;justify-content:center;padding:14px;z-index:100;
    }
    .modal-content{
      width:min(900px,96vw);background:linear-gradient(160deg,#10192f,#0d1630);
      border:1px solid #20355f;border-radius:18px;padding:16px;box-shadow:0 20px 50px rgba(0,0,0,.35);
      animation:fadeIn .25s ease-out both;
    }
    @keyframes fadeIn{from{opacity:.0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
    .modal-cols{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    .help-list{margin:8px 0 0 0;padding-left:18px}
    .help-list li{margin:6px 0}

    .popup{position:fixed;bottom:24px;right:24px;z-index:101}
    .popup-content{
      width:min(420px,92vw);background:#0f1a32;border:1px solid #2a4068;border-radius:14px;box-shadow:0 12px 36px rgba(0,0,0,.35);
    }
    .popup-header{display:flex;align-items:center;justify-content:space-between;padding:10px;border-bottom:1px solid #233a60}
    #popupWord{font-weight:800;color:#9bd6ff}
    .popup-body{padding:10px}
    .popup-body .row{margin:6px 0}
    .popup-body .label{color:#9bb3cc;font-size:.9rem}
    .popup-body .value{color:#eaf4ff}

    .exam-content .exam-body{margin-top:10px}
    .exam-question{padding:10px;border:1px solid #2a4068;border-radius:12px;background:#0f1a32;margin-bottom:10px}
    .exam-question h4{margin:0 0 6px}

    .verbs-body{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:10px}
    .verb-card{background:#0f1a32;border:1px solid #2a4068;border-radius:12px;padding:10px}
    .verb-head{display:flex;align-items:center;justify-content:space-between}
    .verb-head .forms{font-weight:700;color:#9bd6ff}
    .verb-ex{margin-top:6px;color:#eaf4ff}

    .listening-card{
      background: linear-gradient(135deg,#1e3c72,#2a5298);color:#fff;padding:18px;border-radius:16px;margin:18px 0;
      box-shadow:0 8px 20px rgba(0,0,0,0.3);font-family:'Poppins','Vazirmatn',sans-serif;position:relative;overflow:hidden;
    }
    .listening-card::before{
      content:"";position:absolute;inset:-40% -40% auto auto;width:240px;height:240px;
      background:radial-gradient(circle at center, rgba(255,255,255,.15), transparent 60%);transform:rotate(25deg);
    }
    .listening-card h2{margin-top:0;font-size:1.25rem;color:#ffd166}
    .listening-text{line-height:1.85;font-size:1rem;margin-bottom:12px}
    .listen-btn{
      background:linear-gradient(90deg,#13d38b,#71d7ff);border:none;padding:10px 16px;border-radius:12px;
      font-weight:700;cursor:pointer;color:#06233a;transition:transform .2s, box-shadow .2s;
    }
    .listen-btn:hover{transform:scale(1.05);box-shadow:0 0 12px rgba(113,215,255,0.6)}

    @media (max-width:600px){
      .hero{flex-direction:column;align-items:flex-start}
      .hero-visual{width:100%;height:100px}
    }
  </style>
</head>
<body>

  <audio id="bgMusic" loop preload="auto">
    <!-- Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø² Ù…Ø³ÛŒØ± ÙØ§ÛŒÙ„ Ù…ÙˆØ³ÛŒÙ‚ÛŒ Ø±Ø§ Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯ -->
    <source src="" type="audio/mpeg" />
  </audio>

  <header class="topbar" role="banner">
    <div class="left-controls">
      <button class="btn glow-btn" id="musicBtn" aria-label="Play/Pause music">â™« Ù…ÙˆØ³ÛŒÙ‚ÛŒ</button>
    </div>
    <div class="brand-title">Prospect 3 â€” Interactive Flipbook</div>
    <div class="right-controls">
      <button class="btn outline-btn" id="helpBtn" aria-label="Help">Ø±Ø§Ù‡Ù†Ù…Ø§</button>
    </div>
  </header>

  <section class="start-screen" id="startScreen">
    <div class="start-card">
      <div class="hero">
        <div class="hero-title">
          <h1 class="title">English for Schools â€” Prospect 3</h1>
          <p class="subtitle">Lessons â€¢ Practice â€¢ Workbook â€¢ Audio â€¢ Photo Dictionary â€¢ Exams</p>
        </div>
        <div class="hero-visual" aria-hidden="true">
          <div class="orb orb1"></div>
          <div class="orb orb2"></div>
          <div class="orb orb3"></div>
        </div>
      </div>

      <div class="designer-bar">
        <img class="designer-photo" src="https://s34.picofile.com/file/8488183492/2.png" alt="Designer portrait" />
        <div class="designer-meta">
          <div class="designer-name">Designer</div>
          <div class="designer-id">A.R. Yousefzadeh</div>
        </div>
      </div>

      <h2 class="section-head">Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø±Ø³</h2>
      <div class="lesson-grid">
        <button class="lesson-btn pulse" data-lesson="1"><span>Lesson 1</span><small>Personality</small></button>
        <button class="lesson-btn pulse" data-lesson="2"><span>Lesson 2</span><small>Travel</small></button>
        <button class="lesson-btn pulse" data-lesson="3"><span>Lesson 3</span><small>Festivals & Ceremonies</small></button>
        <button class="lesson-btn pulse" data-lesson="4"><span>Lesson 4</span><small>Services</small></button>
        <button class="lesson-btn pulse" data-lesson="5"><span>Lesson 5</span><small>Media</small></button>
        <button class="lesson-btn pulse" data-lesson="6"><span>Lesson 6</span><small>Health & Injuries</small></button>
      </div>

      <h2 class="section-head">Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§</h2>
      <div class="exam-grid">
        <button class="exam-btn glow" data-exam="midterm-1-3">Midterm A â€” Lessons 1â€“3</button>
        <button class="exam-btn glow" data-exam="midterm-1-3b">Midterm B â€” Lessons 1â€“3</button>
        <button class="exam-btn glow" data-exam="final-4-6">Final A â€” Lessons 4â€“6</button>
        <button class="exam-btn glow" data-exam="final-4-6b">Final B â€” Lessons 4â€“6</button>
      </div>

      <h2 class="section-head">Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§</h2>
      <div class="tools-grid">
        <button class="btn gradient-btn" id="irregularVerbsBtn">Ø§ÙØ¹Ø§Ù„ Ø¨ÛŒâ€ŒÙ‚Ø§Ø¹Ø¯Ù‡ + ØªÙ„ÙØ¸ + Ù…Ø«Ø§Ù„</button>
        <button class="btn gradient-btn" id="openVocabTrainerBtn">ÙˆØ§Ú˜Ù‡â€ŒÙ†Ø§Ù…Ù‡ ØªØ¹Ø§Ù…Ù„ÛŒ (Pronunciation + Examples)</button>
      </div>
    </div>
  </section>

  <main id="flipbookWrapper" class="hidden">
    <div class="flipbook-nav">
      <button class="btn nav-btn" id="prevPageBtn" aria-label="Previous page">â€¹</button>
      <div class="current-title" id="currentTitle"></div>
      <button class="btn nav-btn" id="nextPageBtn" aria-label="Next page">â€º</button>
    </div>
    <div class="flipbook" id="flipbook"></div>

    <footer class="designer-footer">
      <div class="designer-bar">
        <img class="designer-photo" src="https://s34.picofile.com/file/8488183492/2.png" alt="Designer portrait" />
        <div class="designer-meta">
          <div class="designer-name">Designer</div>
          <div class="designer-id">A.R. Yousefzadeh</div>
        </div>
      </div>
    </footer>
  </main>

  <div class="modal hidden" id="helpModal" aria-hidden="true" role="dialog" aria-label="Help dialog">
    <div class="modal-content">
      <h2>Ø±Ø§Ù‡Ù†Ù…Ø§</h2>
      <div class="modal-cols">
        <div>
          <h3>ÙØ§Ø±Ø³ÛŒ</h3>
          <ul class="help-list">
            <li><b>Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø±Ø³:</b> Ø§Ø² ØµÙØ­Ù‡â€ŒÛŒ Ø¢ØºØ§Ø² Ø¯Ø±Ø³ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.</li>
            <li><b>ÙˆØ±Ù‚â€ŒØ²Ù†:</b> Ø¨Ø§ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ â€¹ Ùˆ â€º Ø¨ÛŒÙ† ØµÙØ­Ø§Øª Ø­Ø±Ú©Øª Ú©Ù†ÛŒØ¯. Ø±ÙˆÛŒ Ú©Ù„Ù…Ø§Øª Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ ØªØ§ Ù…Ø¹Ù†ÛŒ ÙØ§Ø±Ø³ÛŒØŒ Ù…ØªØ±Ø§Ø¯Ùâ€ŒÙ‡Ø§ØŒ Ú©Ù„Ù…Ø§Øª Ù…Ø±ØªØ¨Ø·ØŒ Ø¬Ù…Ù„Ù‡â€ŒÛŒ Ù†Ù…ÙˆÙ†Ù‡ Ùˆ ØªÙ„ÙØ¸ Ø±Ø§ Ø¨Ø¨ÛŒÙ†ÛŒØ¯.</li>
            <li><b>Ø´Ù†ÛŒØ¯Ø§Ø±ÛŒ (A/B):</b> Ù…ØªÙ† Ø¯Ø± Ú©Ø§Ø¯Ø± Ø²ÛŒØ¨Ø§ + Ø¯Ú©Ù…Ù‡ Ù¾Ø®Ø´ ØµÙˆØª.</li>
            <li><b>ØªÙ…Ø±ÛŒÙ†Ø§Øª Ú©ØªØ§Ø¨ Ú©Ø§Ø±:</b> Ù¾Ø§Ø³Ø® Ø±Ø§ ØªØ§ÛŒÙ¾ ÛŒØ§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ Ùˆ Ø¨Ø§ Â«Ù†Ù…Ø§ÛŒØ´ Ù¾Ø§Ø³Ø®Â» Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.</li>
            <li><b>Ú¯Ø±Ø§Ù…Ø±:</b> Ø¯Ú©Ù…Ù‡â€ŒÛŒ Ù†Ù…Ø§ÛŒØ´ ØªÙˆØ¶ÛŒØ­Ø§Øª Ù‚Ø§Ø¹Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù…Ø·Ø§Ù„Ø¹Ù‡â€ŒÛŒ Ø³Ø±ÛŒØ¹.</li>
            <li><b>Photo Dictionary:</b> ØªÙ„ÙØ¸ØŒ Ù…Ø¹Ù†ÛŒ Ùˆ Ù…Ø«Ø§Ù„ Ø³Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø¹Ø¨Ø§Ø±Øªâ€ŒÙ‡Ø§.</li>
            <li><b>Ø§ÙØ¹Ø§Ù„ Ø¨ÛŒâ€ŒÙ‚Ø§Ø¹Ø¯Ù‡:</b> Ù„ÛŒØ³Øª Ù‡Ù…Ø±Ø§Ù‡ Ø¨Ø§ ØªÙ„ÙØ¸ Ùˆ Ù…Ø«Ø§Ù„ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ/ÙØ§Ø±Ø³ÛŒ.</li>
            <li><b>Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§:</b> Ù…ÛŒØ§Ù†â€ŒØªØ±Ù… Ùˆ Ù¾Ø§ÛŒØ§Ù†â€ŒØªØ±Ù… ØªØ¹Ø§Ù…Ù„ÛŒ Ø¨Ø§ Ù†Ù…Ø§ÛŒØ´ Ù¾Ø§Ø³Ø®Ù†Ø§Ù…Ù‡.</li>
          </ul>
        </div>
        <div>
          <h3>English</h3>
          <ul class="help-list">
            <li><b>Select lessons:</b> Choose a lesson on the start screen.</li>
            <li><b>Flipbook:</b> Use â€¹ and â€º; click words for meaning, synonyms, related words, sample sentence, and pronunciation.</li>
            <li><b>Listening (A/B):</b> Transcript + Play button in styled cards.</li>
            <li><b>Workbook:</b> Type/select answers; â€œShow answerâ€.</li>
            <li><b>Grammar:</b> Toggle explanation.</li>
            <li><b>Photo Dictionary:</b> Pronunciation + Persian meaning + examples.</li>
            <li><b>Irregular Verbs:</b> Styled list with TTS and examples.</li>
            <li><b>Exams:</b> Interactive with reveal answers.</li>
          </ul>
        </div>
      </div>
      <button class="btn outline-btn" id="closeHelpBtn">Ø¨Ø³ØªÙ†</button>
    </div>
  </div>

  <div class="popup hidden" id="wordPopup" role="dialog" aria-hidden="true" aria-label="Word info">
    <div class="popup-content">
      <div class="popup-header">
        <span id="popupWord"></span>
        <div class="popup-actions">
          <button class="btn small" id="pronounceBtn">ğŸ”Š ØªÙ„ÙØ¸</button>
          <button class="btn small" id="closePopupBtn">âœ•</button>
        </div>
      </div>
      <div class="popup-body" id="popupBody"></div>
    </div>
  </div>

  <div class="modal hidden" id="examModal" aria-hidden="true" role="dialog" aria-label="Exam">
    <div class="modal-content exam-content">
      <div class="exam-header">
        <h2 id="examTitle"></h2>
        <button class="btn outline-btn" id="closeExamBtn">Ø¨Ø³ØªÙ†</button>
      </div>
      <div class="exam-body" id="examBody"></div>
      <div class="exam-footer">
        <button class="btn glow-btn" id="submitExamBtn">Ø«Ø¨Øª Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§</button>
        <button class="btn outline-btn" id="showExamAnswersBtn">Ù†Ù…Ø§ÛŒØ´ Ù¾Ø§Ø³Ø®Ù†Ø§Ù…Ù‡</button>
      </div>
    </div>
  </div>

  <div class="modal hidden" id="verbsModal" aria-hidden="true" role="dialog" aria-label="Irregular verbs">
    <div class="modal-content verbs-content">
      <div class="verbs-header">
        <h2>Ø§ÙØ¹Ø§Ù„ Ø¨ÛŒâ€ŒÙ‚Ø§Ø¹Ø¯Ù‡</h2>
        <button class="btn outline-btn" id="closeVerbsBtn">Ø¨Ø³ØªÙ†</button>
      </div>
      <div class="verbs-body" id="verbsBody"></div>
    </div>
  </div>

  <div class="modal hidden" id="vocabModal" aria-hidden="true" role="dialog" aria-label="Vocab trainer">
    <div class="modal-content">
      <h2>ÙˆØ§Ú˜Ù‡â€ŒÙ†Ø§Ù…Ù‡ ØªØ¹Ø§Ù…Ù„ÛŒ</h2>
      <div class="vocab-body">
        <div class="vocab-controls">
          <input id="vocabSearch" type="text" placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ ÙˆØ§Ú˜Ù‡ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ..." aria-label="Search English word" />
          <button class="btn" id="vocabPronounceBtn">ğŸ”Š ØªÙ„ÙØ¸</button>
        </div>
        <div id="vocabResult" class="vocab-result"></div>
      </div>
      <button class="btn outline-btn" id="closeVocabBtn">Ø¨Ø³ØªÙ†</button>
    </div>
  </div>

  <script>
    // --- Data: Lessons 1â€“6 with Listening A/B ---
    window.LESSONS = [
      {
        id: 1, title: "Lesson 1 â€” Personality",
        sections: [
          { type:"conversation", title:"Conversation", text:`
Ehsan: Who is your best friend at school?
Parham: Reza.
Ehsan: What's he like?
Parham: Oh, he is really great! He's clever and kind.
Ehsan: Is he hard-working too?
Parham: Yes! And he's always very helpful.
Ehsan: How?
Parham: He always helps me with my lessons.` },
          { type:"practice", title:"Practice 1 â€” Talking about personality (1)", items:[
            { q:"Are you hard-working?", a:"Yes, I am." },
            { q:"Is he clever?", a:"Yes, he is." },
            { q:"Is Zahra talkative?", a:"No, she isn't." },
            { q:"Are they neat?", a:"Yes, they are." },
            { q:"Are they upset?", a:"No, they're not." }
          ]},
          { type:"practice", title:"Practice 2 â€” Talking about personality (2)", items:[
            { q:"What's your friend like?", a:"He's very funny." },
            { q:"What's your mother like?", a:"She's very kind and patient." },
            { q:"What's he like?", a:"He is quiet." },
            { q:"What's she like?", a:"She is clever." },
            { q:"What are you like?", a:"I'm a bit serious." },
            { q:"What are they like?", a:"They are very kind." }
          ]},
          { type:"languageMelody", title:"Language Melody â€” Affirmative",
            lines:[
              "Farzaneh is a clever student. Everybody likes her.",
              "Yes. I know. She is also very helpful.",
              "Well, you can ask her for help.",
              "Ok, I'll ask her to help me with my English."
            ],
            practice:[
              "He's very kind.","She's very patient.","You are very clever.",
              "Everybody likes her.","I do my homework.","She works for a company."
            ]
          },
          { type:"grammar", title:"Grammar â€” To be, Questions, There is/are",
            blocks:[
              { label:"Affirmative (to be)", text:"I am happy. He/She is happy. We/You/They are happy." },
              { label:"Questions (to be)", text:"Am I ... ? Is he/she ... ? Are we/you/they ... ?" },
              { label:"There is/are", text:"There is an eraser in the classroom. There are many students." },
              { label:"Negative (to be)", text:"I'm not talkative. He's not shy (He isn't shy). They're not rude (They aren't rude)." }
            ]
          },
          { type:"findIt", title:"Find it â€” underline 'to be' verbs",
            text:"I'm Mohsen. This is my classroom. There are 25 students in my class. I have a lot of friends. My best friend is Vahid. He's a good student. He is helpful and hard-working, but he is not very careful. He usually forgets important things. It's a big problem."
          },
          { type:"listeningCard", title:"Lesson 1 â€” Listening Part A",
            audio:"https://s34.picofile.com/file/8488257092/6A.mp3.html",
            text:`Haniyeh: Who is she, Anita?
Anita: She is my mother, Zahra.
Haniyeh: Tell me about her. What is she like?
Anita: Well, she's great. She's very kind and helpful.` },
          { type:"listeningCard", title:"Lesson 1 â€” Listening Part B",
            audio:"https://s34.picofile.com/file/8488257100/6B.mp3.html",
            text:`Iran is a great country. There are a lot of cities and villages here. Iranian people are very kind and friendly. They are also really brave and hard- working. We all love our beautiful country.` },
          { type:"workbook", title:"Workbook â€” Lesson 1 (Ù†Ù…ÙˆÙ†Ù‡)",
            items:[
              { type:"choice", q:"Kate isn't/aren't funny.", correct:"isn't" },
              { type:"choice", q:"There is/are a car in the street.", correct:"is" },
              { type:"choice", q:"There is/are fifteen benches in the class.", correct:"are" },
              { type:"choice", q:"It is/are really beautiful.", correct:"is" },
              { type:"choice", q:"Iranians is/are very brave.", correct:"are" }
            ]
          },
          { type:"photoDict", title:"Photo Dictionary â€” Personality (Ù†Ù…ÙˆÙ†Ù‡)",
            phrases:[
              { en:"an angry kid", fa:"ÛŒÚ© Ø¨Ú†Ù‡ Ø¹ØµØ¨Ø§Ù†ÛŒ", ex:"The angry kid shouted loudly.", tts:true },
              { en:"a brave soldier", fa:"ÛŒÚ© Ø³Ø±Ø¨Ø§Ø² Ø´Ø¬Ø§Ø¹", ex:"The brave soldier helped people.", tts:true },
              { en:"a neat person", fa:"ÛŒÚ© ÙØ±Ø¯ Ù…Ø±ØªØ¨", ex:"He is a neat person.", tts:true }
            ]
          }
        ]
      },
      {
        id: 2, title: "Lesson 2 â€” Travel",
        sections: [
          { type:"conversation", title:"Conversation", text:`
Receptionist: Welcome to our hotel sir, how can I help you?
Tourist: My name is Paul Kress. I'm from Germany. I have a reservation here.
Receptionist: I see! Are you staying here for two nights?
Tourist: Yes, my wife and I are visiting Tehran for three days.
Receptionist: Where is she now? I need to check her passport.
Tourist: She's standing over there, by the gift shop. Here is her passport.
Receptionist: Thank you. This is your key. It's room 213. Hope you enjoy your stay in Tehran.` },
          { type:"listeningCard", title:"Lesson 2 â€” Listening Part A",
            audio:"https://s34.picofile.com/file/8488257218/026_A.mp3.html",
            text:`Receptionist: Hello, who is speaking?
Brenda: Hi, it is Brenda from England.
Receptionist: How can I help you madam?
Brenda: I'm checking your website but I can't find the reservation section.
Receptionist: OK! Let me help you.
Brenda: Thank you so much.` },
          { type:"listeningCard", title:"Lesson 2 â€” Listening Part B",
            audio:"https://s34.picofile.com/file/8488257226/026_B.mp3.html",
            text:`Mehmet is a tourist from Turkey. He's visiting Iran. Now, he is buying a ticket to Mashhad. He's talking with the front-desk. He is asking about the ticket price. He wants to stay in Mashhad for two nights.` }
        ]
      },
      {
        id: 3, title: "Lesson 3 â€” Festivals & Ceremonies",
        sections: [
          { type:"conversation", title:"Conversation", text:`
Elham: I just love New Year holidays!
Nasrin: Oh, yes, me too. It's really great.
Elham: We normally visit our relatives in Norooz. It's fun!
Nasrin: Do you get New Year gifts too?
Elham: Sure! We usually get money. I really like it.
Nasrin: Well ... , We always go to my grandparents' houses.
Elham: That's nice! Does your grandmother cook the New Year meal?
Nasrin: Actually, she doesn't. My mother makes it.` },
          { type:"listeningCard", title:"Lesson 3 â€” Listening Part A",
            audio:"https://s34.picofile.com/file/8488257234/036_A.mp3.html",
            text:`Zohreh: Do you stay home at Yalda Night?
Ayda: No, we don't. We go to my grandparents' house.
Zohreh: How nice! What do you do there?
Ayda: We sit together and listen to poems of Hafez.
Zohreh: Nice! Do you eat watermelon?
Ayda: Yes, we do! We also have nuts.
Zohreh: It sounds great!` },
          { type:"listeningCard", title:"Lesson 3 â€” Listening Part B",
            audio:"https://s34.picofile.com/file/8488257242/036_B.mp3.html",
            text:`"Hi, I'm from China. In my country New Year starts in January or February. It changes every year! Umm ... Red is very important for Chinese people. People wear red clothes. Oh! And older people give lucky money to children in red envelopes."` }
        ]
      },
      {
        id: 4, title: "Lesson 4 â€” Services",
        sections: [
          { type:"conversation", title:"Conversation", text:`
Tourist: Excuse me sir! Can you help me please?
Pedram: What can I do for you?
Tourist: I want a postcard, an envelope and a stamp.
Pedram: Umm ... , you can get them from a post office.
Tourist: Where is the post office?
Pedram: Actually it's near here. It's just round the corner.
Tourist: Good! Thank you. What time does it open?
Pedram: It opens at 8.
Tourist: Thanks a lot!` },
          { type:"listeningCard", title:"Lesson 4 â€” Listening Part A",
            audio:"https://s34.picofile.com/file/8488257250/046_A.mp3.html",
            text:`Interviewer: What do you do?
Baker: I'm a baker.
Interviewer: Where do you work?
Baker: I work in a bakery.
Interviewer: When does your work start?
Baker: It starts very early in the morning.
Interviewer: Is your job difficult?
Baker: Well, I work in a very hot place.` },
          { type:"listeningCard", title:"Lesson 4 â€” Listening Part B",
            audio:"https://s34.picofile.com/file/8488257268/046_B.mp3.html",
            text:`Amir is a police officer. He works at a police station. He goes to work Saturdays to Wednesdays, 7 a.m. till 4 p.m. He drives his car around the city and makes sure everything is OK.` }
        ]
      },
      {
        id: 5, title: "Lesson 5 â€” Media",
        sections: [
          { type:"conversation", title:"Conversation", text:`
Mina: Did you enjoy your weekend?
Mahsa: Yes, it was wonderful! I attended Fajr International Film Festival.
Mina: Really? I am also interested in its events and movies.
Mahsa: Oh, did you watch the reports on TV last night?
Mina: Yes, I did, but I like to read about them.
Mahsa: Well, you can surf its website if you like. There are many interesting things there.
Mina: That's great! Could you please give me the website address?
Mahsa: Why not! Just a moment. Umm ... I just texted it.
Mina: Thanks a lot.` },
          { type:"listeningCard", title:"Lesson 5 â€” Listening Part A",
            audio:"https://s34.picofile.com/file/8488257326/056_A.mp3.html",
            text:`Amir: How was your summer?
Behnam: Brilliant! I went to a computer class. I learned many things about Information Technology.
Amir: Great! Did you learn how to use computers for doing your homework?
Behnam: Yes, I also learned to use the Internet for my English class.` },
          { type:"listeningCard", title:"Lesson 5 â€” Listening Part B",
            audio:"https://s34.picofile.com/file/8488257350/056_B.mp3.html",
            text:`This summer, there were 2 interesting movies in the cinemas: a cartoon and a comedy. I liked to see both. But I just watched the cartoon. The cinemas were full of people and it was difficult to buy tickets. Later I watched the CD of the comedy at home.` }
        ]
      },
      {
        id: 6, title: "Lesson 6 â€” Health & Injuries",
        sections: [
          { type:"conversation", title:"Conversation", text:`
Reza: We plan to go to the lake. Do you want to come?
Ehsan: I don't think so. I don't like school trips. Last summer I fell and broke my leg.
Reza: It sometimes happens. I twisted my ankle last winter. I stayed home for two weeks!
Ehsan: That's too bad! I didn't know that.
Reza: Yeah ... , but after that, I participated in Helal-e-Ahmar first aid classes. I learned how to take care of myself.
Ehsan: I like that. Can you give me some advice?
Reza: Sure!` },
          { type:"listeningCard", title:"Lesson 6 â€” Listening Part A",
            audio:"https://s34.picofile.com/file/8488257376/066_A.mp3.html",
            text:`Behnaz: Mother, please help me. I think I just broke my leg.
Mother: What happened dear?
Behnaz: I didn't see this ball and I fell down. My leg hurts a lot.
Mother: Sit down and don't move. Let me call 115.` },
          { type:"listeningCard", title:"Lesson 6 â€” Listening Part B",
            audio:"https://s34.picofile.com/file/8488257400/066_B.mp3.html",
            text:`Omid is a firefighter. Last week he went to put out a big fire in a small house. There was a child in the fire. The child hurt her ankle and could not come out of the house. Omid went into the fire and saved the child. He hurt his back. He got some bruises on his hands and legs. He is in the hospital now. But he is very happy he saved the child.` }
        ]
      }
    ];

    // --- Dictionary (initial; extend freely) ---
    window.DICT = {
      "clever": { fa:"Ø¨Ø§Ù‡ÙˆØ´", syn:["smart","bright","intelligent"], rel:["wise","brainy"], ex:"He is a clever student." },
      "kind": { fa:"Ù…Ù‡Ø±Ø¨Ø§Ù†", syn:["nice","friendly","helpful"], rel:["polite","gentle"], ex:"She is kind to everyone." },
      "hard-working": { fa:"Ù¾Ø±ØªÙ„Ø§Ø´", syn:["diligent","industrious"], rel:["active","busy"], ex:"They are hard-working people." },
      "helpful": { fa:"Ú©Ù…Ú©â€ŒÚ©Ù†Ù†Ø¯Ù‡", syn:["supportive","useful"], rel:["kind","friendly"], ex:"He is helpful in class." },
      "funny": { fa:"Ø®Ù†Ø¯Ù‡â€ŒØ¯Ø§Ø±", syn:["humorous","amusing"], rel:["happy","jolly"], ex:"It is a funny story." },
      "quiet": { fa:"Ø¢Ø±Ø§Ù…", syn:["silent","calm"], rel:["peaceful","still"], ex:"This is a quiet place." }
    };

    // --- Exams ---
    window.EXAMS = {
      "midterm-1-3": {
        title:"Midterm Exam A â€” Lessons 1â€“3",
        questions:[
          { type:"mc", q:"Choose the correct 'to be' form: They __ kind.", opts:["is","are","am"], key:"are" },
          { type:"short", q:"Write a question with 'What's he like?' and answer briefly." },
          { type:"mc", q:"Present Simple: She __ lunch at noon.", opts:["cook","cooks","is cooking"], key:"cooks" },
          { type:"match", q:"Match personality words", pairs:[["brave","Ø´Ø¬Ø§Ø¹"],["neat","Ù…Ø±ØªØ¨"],["rude","Ø¨ÛŒâ€ŒØ§Ø¯Ø¨"],["careless","Ø¨ÛŒâ€ŒØ¯Ù‚Øª"]] },
          { type:"fill", q:"There __ many tourists in this city. (is/are)", key:"are" },
          { type:"short", q:"Write a sentence using 'There is/There are' (Festivals or Travel topic)." },
          { type:"mc", q:"Do/Does: __ you visit your relatives on holidays?", opts:["Do","Does"], key:"Do" },
          { type:"mc", q:"Which has rising intonation?", opts:["Affirmative sentence","Yes/No question"], key:"Yes/No question" },
          { type:"short", q:"Write two personality adjectives and describe a classmate." },
          { type:"mc", q:"Choose: We __ to a museum. (often/never/rarely)", opts:["often","never","rarely"], key:"often" }
        ]
      },
      "midterm-1-3b": {
        title:"Midterm Exam B â€” Lessons 1â€“3",
        questions:[
          { type:"mc", q:"Choose: Is/Are: __ they helpful?", opts:["Is","Are"], key:"Are" },
          { type:"short", q:"Write a 'Find it' sentence and underline 'to be' verbs." },
          { type:"mc", q:"Present Simple: They __ stories at night.", opts:["tell","tells","are telling"], key:"tell" },
          { type:"fill", q:"Complete: What's your friend like? â€” He __ funny.", key:"is" },
          { type:"mc", q:"Choose: Do/Does __ she get gifts on Norooz?", opts:["Do","Does"], key:"Does" },
          { type:"short", q:"Write a sentence about a festival activity (use 'we')." },
          { type:"mc", q:"Choose: Affirmative intonation goes (falling/rising).", opts:["falling","rising"], key:"falling" },
          { type:"match", q:"Match travel verbs", pairs:[["check in","ØªØ­ÙˆÛŒÙ„ Ø§ØªØ§Ù‚"],["take off","Ø¨Ø±Ø®Ø§Ø³ØªÙ†"],["land","ÙØ±ÙˆØ¯ Ø¢Ù…Ø¯Ù†"],["exchange money","ØªØ¹ÙˆÛŒØ¶ Ù¾ÙˆÙ„"]] },
          { type:"fill", q:"There __ a computer in the classroom. (is/are)", key:"is" },
          { type:"short", q:"Write two 'Do/Does' questions about travel." }
        ]
      },
      "final-4-6": {
        title:"Final Exam A â€” Lessons 4â€“6",
        questions:[
          { type:"mc", q:"WH question: __ do you live?", opts:["Where","What","Who"], key:"Where" },
          { type:"mc", q:"Adverb of frequency: She __ studies hard.", opts:["never","always","rarely"], key:"always" },
          { type:"mc", q:"Past Simple: He __ a message yesterday.", opts:["send","sends","sent"], key:"sent" },
          { type:"fill", q:"Complete: He __ his leg last week. (broke / break)", key:"broke" },
          { type:"match", q:"Match services", pairs:[["put out fire","Ø¢ØªØ´ Ø±Ø§ Ø®Ø§Ù…ÙˆØ´ Ú©Ø±Ø¯Ù†"],["hire a taxi","Ú¯Ø±ÙØªÙ† ØªØ§Ú©Ø³ÛŒ"],["open an account","Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø­Ø³Ø§Ø¨"],["call 115","ØªÙ…Ø§Ø³ Ø¨Ø§ Ø§ÙˆØ±Ú˜Ø§Ù†Ø³"]] },
          { type:"short", q:"Write 2 sentences with 'was/were' (media or services)." },
          { type:"mc", q:"Choose: Past of 'go' is __.", opts:["went","goed","gone"], key:"went" },
          { type:"short", q:"Write an injury report sentence with 'hurt'." },
          { type:"mc", q:"Choose: Past of 'take off' is __.", opts:["taked off","took off","taken off"], key:"took off" },
          { type:"short", q:"Write a WH question about a service in your city." }
        ]
      },
      "final-4-6b": {
        title:"Final Exam B â€” Lessons 4â€“6",
        questions:[
          { type:"mc", q:"WH question: __ does the bank open?", opts:["Where","When","Why"], key:"When" },
          { type:"mc", q:"Past of 'see' is __.", opts:["saw","seed","seen"], key:"saw" },
          { type:"fill", q:"Complete: They __ on TV last night. (watched / watch)", key:"watched" },
          { type:"short", q:"Write 2 sentences using 'always/never' about services." },
          { type:"mc", q:"Choose: Past of 'break' is __.", opts:["breaked","broke","broken"], key:"broke" },
          { type:"match", q:"Match health phrases", pairs:[["It is bleeding","Ø®ÙˆÙ†â€ŒØ±ÛŒØ²ÛŒ Ø¯Ø§Ø±Ø¯"],["Stick a plaster","Ú†Ø³Ø¨ Ø²Ø®Ù… Ø¨Ø²Ù†"],["He hit his head","Ø³Ø±Ø´ Ø±Ø§ Ø²Ø¯"],["She cut her finger","Ø§Ù†Ú¯Ø´ØªØ´ Ø±Ø§ Ø¨Ø±ÛŒØ¯"]] },
          { type:"short", q:"Write a 'Do/Does' question and answer (media)." },
          { type:"mc", q:"Choose: Past of 'write' is __.", opts:["writed","wrote","written"], key:"wrote" },
          { type:"fill", q:"Complete: He __ in the ER. (works / worked) â€” choose one and justify.", key:"works" },
          { type:"short", q:"Write a WH question about an accident." }
        ]
      }
    };

    // --- Irregular verbs list ---
    window.IRREGULAR_VERBS = [
      { base:"be", past:"was/were", exEn:"I was happy yesterday.", exFa:"Ù…Ù† Ø¯ÛŒØ±ÙˆØ² Ø®ÙˆØ´Ø­Ø§Ù„ Ø¨ÙˆØ¯Ù…." },
      { base:"become", past:"became", exEn:"She became a doctor.", exFa:"Ø§Ùˆ Ø¯Ú©ØªØ± Ø´Ø¯." },
      { base:"bleed", past:"bled", exEn:"It bled a lot.", exFa:"Ø®ÛŒÙ„ÛŒ Ø®ÙˆÙ†â€ŒØ±ÛŒØ²ÛŒ Ú©Ø±Ø¯." },
      { base:"break", past:"broke", exEn:"He broke his leg.", exFa:"Ø§Ùˆ Ù¾Ø§ÛŒØ´ Ø±Ø§ Ø´Ú©Ø³Øª." },
      { base:"bring", past:"brought", exEn:"They brought food.", exFa:"Ø¢Ù†â€ŒÙ‡Ø§ ØºØ°Ø§ Ø¢ÙˆØ±Ø¯Ù†Ø¯." },
      { base:"build", past:"built", exEn:"We built a bridge.", exFa:"Ù…Ø§ ÛŒÚ© Ù¾Ù„ Ø³Ø§Ø®ØªÛŒÙ…." },
      { base:"buy", past:"bought", exEn:"She bought a ticket.", exFa:"Ø§Ùˆ Ø¨Ù„ÛŒØ· Ø®Ø±ÛŒØ¯." },
      { base:"choose", past:"chose", exEn:"He chose the movie.", exFa:"Ø§Ùˆ ÙÛŒÙ„Ù… Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø±Ø¯." },
      { base:"come", past:"came", exEn:"They came late.", exFa:"Ø¢Ù†â€ŒÙ‡Ø§ Ø¯ÛŒØ± Ø¢Ù…Ø¯Ù†Ø¯." },
      { base:"cut", past:"cut", exEn:"I cut my finger.", exFa:"Ù…Ù† Ø§Ù†Ú¯Ø´ØªÙ… Ø±Ø§ Ø¨Ø±ÛŒØ¯Ù…." },
      { base:"do", past:"did", exEn:"We did our homework.", exFa:"Ù…Ø§ ØªÚ©Ù„ÛŒÙâ€ŒÙ…Ø§Ù† Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ø§Ø¯ÛŒÙ…." },
      { base:"drink", past:"drank", exEn:"He drank water.", exFa:"Ø§Ùˆ Ø¢Ø¨ Ù†ÙˆØ´ÛŒØ¯." },
      { base:"drive", past:"drove", exEn:"She drove to Tehran.", exFa:"Ø§Ùˆ Ø¨Ù‡ ØªÙ‡Ø±Ø§Ù† Ø±Ø§Ù†Ù†Ø¯Ú¯ÛŒ Ú©Ø±Ø¯." },
      { base:"eat", past:"ate", exEn:"They ate lunch.", exFa:"Ø¢Ù†â€ŒÙ‡Ø§ Ù†Ø§Ù‡Ø§Ø± Ø®ÙˆØ±Ø¯Ù†Ø¯." },
      { base:"fall", past:"fell", exEn:"He fell down.", exFa:"Ø§Ùˆ Ø§ÙØªØ§Ø¯." },
      { base:"feel", past:"felt", exEn:"I felt tired.", exFa:"Ù…Ù† Ø§Ø­Ø³Ø§Ø³ Ø®Ø³ØªÚ¯ÛŒ Ú©Ø±Ø¯Ù…." },
      { base:"find", past:"found", exEn:"We found the shop.", exFa:"Ù…Ø§ Ù…ØºØ§Ø²Ù‡ Ø±Ø§ Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯ÛŒÙ…." },
      { base:"forget", past:"forgot", exEn:"She forgot the keys.", exFa:"Ø§Ùˆ Ú©Ù„ÛŒØ¯Ù‡Ø§ Ø±Ø§ ÙØ±Ø§Ù…ÙˆØ´ Ú©Ø±Ø¯." },
      { base:"get", past:"got", exEn:"I got a message.", exFa:"Ù…Ù† ÛŒÚ© Ù¾ÛŒØ§Ù… Ú¯Ø±ÙØªÙ…." },
      { base:"give", past:"gave", exEn:"He gave me his book.", exFa:"Ø§Ùˆ Ú©ØªØ§Ø¨Ø´ Ø±Ø§ Ø¨Ù‡ Ù…Ù† Ø¯Ø§Ø¯." },
      { base:"go", past:"went", exEn:"They went home.", exFa:"Ø¢Ù†â€ŒÙ‡Ø§ Ø¨Ù‡ Ø®Ø§Ù†Ù‡ Ø±ÙØªÙ†Ø¯." },
      { base:"have", past:"had", exEn:"We had fun.", exFa:"Ù…Ø§ Ø®ÙˆØ´ Ú¯Ø°Ø±Ø§Ù†Ø¯ÛŒÙ…." },
      { base:"hear", past:"heard", exEn:"I heard the news.", exFa:"Ù…Ù† Ø®Ø¨Ø± Ø±Ø§ Ø´Ù†ÛŒØ¯Ù…." },
      { base:"hit", past:"hit", exEn:"He hit his head.", exFa:"Ø§Ùˆ Ø³Ø±Ø´ Ø±Ø§ Ø²Ø¯." },
      { base:"hurt", past:"hurt", exEn:"She hurt her knee.", exFa:"Ø§Ùˆ Ø²Ø§Ù†ÙˆÛŒØ´ Ø±Ø§ Ø¢Ø³ÛŒØ¨ Ø²Ø¯." },
      { base:"keep", past:"kept", exEn:"We kept the ticket.", exFa:"Ù…Ø§ Ø¨Ù„ÛŒØ· Ø±Ø§ Ù†Ú¯Ù‡ Ø¯Ø§Ø´ØªÛŒÙ…." },
      { base:"know", past:"knew", exEn:"He knew the answer.", exFa:"Ø§Ùˆ Ù¾Ø§Ø³Ø® Ø±Ø§ Ù…ÛŒâ€ŒØ¯Ø§Ù†Ø³Øª." },
      { base:"leave", past:"left", exEn:"She left early.", exFa:"Ø§Ùˆ Ø²ÙˆØ¯ Ø±ÙØª." },
      { base:"lose", past:"lost", exEn:"They lost the match.", exFa:"Ø¢Ù†â€ŒÙ‡Ø§ Ù…Ø³Ø§Ø¨Ù‚Ù‡ Ø±Ø§ Ø¨Ø§Ø®ØªÙ†Ø¯." },
      { base:"make", past:"made", exEn:"He made lunch.", exFa:"Ø§Ùˆ Ù†Ø§Ù‡Ø§Ø± Ø¯Ø±Ø³Øª Ú©Ø±Ø¯." },
      { base:"meet", past:"met", exEn:"I met my friend.", exFa:"Ù…Ù† Ø¯ÙˆØ³ØªÙ… Ø±Ø§ Ø¯ÛŒØ¯Ù…." },
      { base:"pay", past:"paid", exEn:"She paid the bill.", exFa:"Ø§Ùˆ ØµÙˆØ±ØªØ­Ø³Ø§Ø¨ Ø±Ø§ Ù¾Ø±Ø¯Ø§Ø®Øª Ú©Ø±Ø¯." },
      { base:"put", past:"put", exEn:"He put it on the table.", exFa:"Ø§Ùˆ Ø¢Ù† Ø±Ø§ Ø±ÙˆÛŒ Ù…ÛŒØ² Ú¯Ø°Ø§Ø´Øª." },
      { base:"read", past:"read (/red)", exEn:"I read a book.", exFa:"Ù…Ù† Ú©ØªØ§Ø¨ÛŒ Ø®ÙˆØ§Ù†Ø¯Ù…." },
      { base:"ride", past:"rode", exEn:"She rode a bike.", exFa:"Ø§Ùˆ Ø¯ÙˆÚ†Ø±Ø®Ù‡â€ŒØ³ÙˆØ§Ø±ÛŒ Ú©Ø±Ø¯." },
      { base:"run", past:"ran", exEn:"They ran fast.", exFa:"Ø¢Ù†â€ŒÙ‡Ø§ Ø³Ø±ÛŒØ¹ Ø¯ÙˆÛŒØ¯Ù†Ø¯." },
      { base:"say", past:"said", exEn:"He said hello.", exFa:"Ø§Ùˆ Ø³Ù„Ø§Ù… Ú¯ÙØª." },
      { base:"see", past:"saw", exEn:"We saw a movie.", exFa:"Ù…Ø§ ÙÛŒÙ„Ù…ÛŒ Ø¯ÛŒØ¯ÛŒÙ…." },
      { base:"set", past:"set", exEn:"They set the table.", exFa:"Ø¢Ù†â€ŒÙ‡Ø§ Ù…ÛŒØ² Ø±Ø§ Ú†ÛŒØ¯Ù†Ø¯." },
      { base:"sell", past:"sold", exEn:"He sold his car.", exFa:"Ø§Ùˆ Ù…Ø§Ø´ÛŒÙ†Ø´ Ø±Ø§ ÙØ±ÙˆØ®Øª." },
      { base:"send", past:"sent", exEn:"She sent an email.", exFa:"Ø§Ùˆ Ø§ÛŒÙ…ÛŒÙ„ÛŒ ÙØ±Ø³ØªØ§Ø¯." },
      { base:"sing", past:"sang", exEn:"He sang a song.", exFa:"Ø§Ùˆ ÛŒÚ© Ø¢Ù‡Ù†Ú¯ Ø®ÙˆØ§Ù†Ø¯." },
      { base:"sit", past:"sat", exEn:"We sat down.", exFa:"Ù…Ø§ Ù†Ø´Ø³ØªÛŒÙ…." },
      { base:"sleep", past:"slept", exEn:"They slept well.", exFa:"Ø¢Ù†â€ŒÙ‡Ø§ Ø®ÙˆØ¨ Ø®ÙˆØ§Ø¨ÛŒØ¯Ù†Ø¯." },
      { base:"speak", past:"spoke", exEn:"She spoke English.", exFa:"Ø§Ùˆ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ ØµØ­Ø¨Øª Ú©Ø±Ø¯." },
      { base:"stand", past:"stood", exEn:"I stood up.", exFa:"Ù…Ù† Ø§ÛŒØ³ØªØ§Ø¯Ù…." },
      { base:"stick", past:"stuck", exEn:"He stuck a poster.", exFa:"Ø§Ùˆ ÛŒÚ© Ù¾ÙˆØ³ØªØ± Ú†Ø³Ø¨Ø§Ù†Ø¯." },
      { base:"swim", past:"swam", exEn:"They swam in the pool.", exFa:"Ø¢Ù†â€ŒÙ‡Ø§ Ø¯Ø± Ø§Ø³ØªØ®Ø± Ø´Ù†Ø§ Ú©Ø±Ø¯Ù†Ø¯." },
      { base:"take", past:"took", exEn:"He took a photo.", exFa:"Ø§Ùˆ ÛŒÚ© Ø¹Ú©Ø³ Ú¯Ø±ÙØª." },
      { base:"take off", past:"took off", exEn:"The plane took off.", exFa:"Ù‡ÙˆØ§Ù¾ÛŒÙ…Ø§ Ø¨Ù„Ù†Ø¯ Ø´Ø¯." },
      { base:"teach", past:"taught", exEn:"She taught math.", exFa:"Ø§Ùˆ Ø±ÛŒØ§Ø¶ÛŒ ØªØ¯Ø±ÛŒØ³ Ú©Ø±Ø¯." },
      { base:"tell", past:"told", exEn:"He told a story.", exFa:"Ø§Ùˆ Ø¯Ø§Ø³ØªØ§Ù†ÛŒ Ú¯ÙØª." },
      { base:"think", past:"thought", exEn:"I thought about it.", exFa:"Ø¯Ø± Ù…ÙˆØ±Ø¯Ø´ ÙÚ©Ø± Ú©Ø±Ø¯Ù…." },
      { base:"understand", past:"understood", exEn:"We understood the lesson.", exFa:"Ù…Ø§ Ø¯Ø±Ø³ Ø±Ø§ ÙÙ‡Ù…ÛŒØ¯ÛŒÙ…." },
      { base:"wake", past:"woke", exEn:"He woke up early.", exFa:"Ø§Ùˆ Ø²ÙˆØ¯ Ø¨ÛŒØ¯Ø§Ø± Ø´Ø¯." },
      { base:"wear", past:"wore", exEn:"She wore a dress.", exFa:"Ø§Ùˆ Ù„Ø¨Ø§Ø³ Ù¾ÙˆØ´ÛŒØ¯." },
      { base:"write", past:"wrote", exEn:"They wrote a letter.", exFa:"Ø¢Ù†â€ŒÙ‡Ø§ Ù†Ø§Ù…Ù‡â€ŒØ§ÛŒ Ù†ÙˆØ´ØªÙ†Ø¯." }
    ];

    // --- App state & elements ---
    const startScreen = document.getElementById('startScreen');
    const flipbookWrapper = document.getElementById('flipbookWrapper');
    const flipbookEl = document.getElementById('flipbook');
    const currentTitleEl = document.getElementById('currentTitle');
    const prevPageBtn = document.getElementById('prevPageBtn');
    const nextPageBtn = document.getElementById('nextPageBtn');
    const helpBtn = document.getElementById('helpBtn');
    const helpModal = document.getElementById('helpModal');
    const closeHelpBtn = document.getElementById('closeHelpBtn');
    const musicBtn = document.getElementById('musicBtn');
    const bgMusic = document.getElementById('bgMusic');
    const irregularVerbsBtn = document.getElementById('irregularVerbsBtn');
    const verbsModal = document.getElementById('verbsModal');
    const closeVerbsBtn = document.getElementById('closeVerbsBtn');
    const verbsBody = document.getElementById('verbsBody');
    const examModal = document.getElementById('examModal');
    const examTitle = document.getElementById('examTitle');
    const examBody = document.getElementById('examBody');
    const closeExamBtn = document.getElementById('closeExamBtn');
    const submitExamBtn = document.getElementById('submitExamBtn');
    const showExamAnswersBtn = document.getElementById('showExamAnswersBtn');
    const wordPopup = document.getElementById('wordPopup');
    const popupWord = document.getElementById('popupWord');
    const popupBody = document.getElementById('popupBody');
    const closePopupBtn = document.getElementById('closePopupBtn');
    const pronounceBtn = document.getElementById('pronounceBtn');
    const vocabModal = document.getElementById('vocabModal');
    const closeVocabBtn = document.getElementById('closeVocabBtn');
    const openVocabTrainerBtn = document.getElementById('openVocabTrainerBtn');
    const vocabSearch = document.getElementById('vocabSearch');
    const vocabResult = document.getElementById('vocabResult');
    const vocabPronounceBtn = document.getElementById('vocabPronounceBtn');

    let currentLesson = null;
    let pages = [];
    let currentPageIndex = 0;
    let currentExam = null;

    const clickSound = new Audio(); clickSound.src = ""; // Ù…Ø³ÛŒØ± ØµØ¯Ø§ÛŒ Ú©Ù„ÛŒÚ© Ø§Ú¯Ø± Ø®ÙˆØ§Ø³ØªÛŒ

    // --- Bindings ---
    document.querySelectorAll('.lesson-btn').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        playClick();
        loadLesson(parseInt(btn.dataset.lesson,10));
      });
    });
    document.querySelectorAll('.exam-btn').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        playClick();
        openExam(btn.dataset.exam);
      });
    });
    musicBtn.addEventListener('click', ()=>{
      playClick();
      if(bgMusic.paused){ bgMusic.play().catch(()=>{}); musicBtn.textContent = "â™« Ù…ÙˆØ³ÛŒÙ‚ÛŒ (Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø®Ø´)"; }
      else{ bgMusic.pause(); musicBtn.textContent = "â™« Ù…ÙˆØ³ÛŒÙ‚ÛŒ"; }
    });
    helpBtn.addEventListener('click', ()=> helpModal.classList.remove('hidden'));
    closeHelpBtn.addEventListener('click', ()=> helpModal.classList.add('hidden'));
    irregularVerbsBtn.addEventListener('click', ()=>{ renderVerbs(); verbsModal.classList.remove('hidden'); });
    closeVerbsBtn.addEventListener('click', ()=> verbsModal.classList.add('hidden'));
    closeExamBtn.addEventListener('click', ()=>{ examModal.classList.add('hidden'); currentExam=null; });
    submitExamBtn.addEventListener('click', gradeExam);
    showExamAnswersBtn.addEventListener('click', showExamAnswers);
    prevPageBtn.addEventListener('click', ()=> turnPage(-1));
    nextPageBtn.addEventListener('click', ()=> turnPage(1));
    closePopupBtn.addEventListener('click', ()=> wordPopup.classList.add('hidden'));
    pronounceBtn.addEventListener('click', ()=> pronounce(popupWord.textContent));
    document.addEventListener('keydown', (e)=>{
      if(e.key==='ArrowRight') turnPage(1);
      if(e.key==='ArrowLeft') turnPage(-1);
      if(e.key==='Escape'){
        helpModal.classList.add('hidden'); verbsModal.classList.add('hidden'); examModal.classList.add('hidden');
        wordPopup.classList.add('hidden'); vocabModal.classList.add('hidden');
      }
    });
    openVocabTrainerBtn.addEventListener('click', ()=>{
      vocabModal.classList.remove('hidden'); vocabSearch.value="";
      vocabResult.innerHTML = `<div style="color:#9bb3cc">ÛŒÚ© ÙˆØ§Ú˜Ù‡ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯...</div>`;
    });
    closeVocabBtn.addEventListener('click', ()=> vocabModal.classList.add('hidden'));
    vocabSearch.addEventListener('input', ()=>{
      const q = (vocabSearch.value||"").trim().toLowerCase();
      if(!q){ vocabResult.innerHTML = `<div style="color:#9bb3cc">ÛŒÚ© ÙˆØ§Ú˜Ù‡ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯...</div>`; return; }
      const info = window.DICT[q];
      if(!info){
        vocabResult.innerHTML = `<div>ÙˆØ±ÙˆØ¯ÛŒ Ø¨Ø±Ø§ÛŒ "<b>${q}</b>" ÛŒØ§ÙØª Ù†Ø´Ø¯. Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¢Ù† Ø±Ø§ Ø¨Ù‡ DICT Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯.</div>`;
      }else{
        vocabResult.innerHTML = `
          <div><b>ÙˆØ§Ú˜Ù‡:</b> ${q}</div>
          <div><b>Ù…Ø¹Ù†ÛŒ ÙØ§Ø±Ø³ÛŒ:</b> ${info.fa}</div>
          <div><b>Ù…ØªØ±Ø§Ø¯Ùâ€ŒÙ‡Ø§:</b> ${(info.syn||[]).join(", ")}</div>
          <div><b>Ú©Ù„Ù…Ø§Øª Ù…Ø±ØªØ¨Ø·:</b> ${(info.rel||[]).join(", ")}</div>
          <div><b>Ù…Ø«Ø§Ù„ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ:</b> ${info.ex}</div>
        `;
      }
    });
    vocabPronounceBtn.addEventListener('click', ()=>{
      const q = (vocabSearch.value||"").trim(); if(q) pronounce(q);
    });

    // --- Core functions ---
    function playClick(){ if(clickSound.src){ clickSound.currentTime=0; clickSound.play().catch(()=>{});} }
    function loadLesson(id){
      const lesson = window.LESSONS.find(l=>l.id===id);
      if(!lesson){ alert("Lesson not found."); return; }
      currentLesson = lesson; startScreen.classList.add('hidden'); flipbookWrapper.classList.remove('hidden');
      currentTitleEl.textContent = lesson.title; pages = buildPages(lesson); currentPageIndex = 0; renderFlipbook();
    }
    function buildPages(lesson){ return lesson.sections.map(sec=> sectionToPage(sec)); }
    function renderFlipbook(){
      flipbookEl.innerHTML = "";
      pages.forEach((page, idx)=>{
        const el = document.createElement('div'); el.className='page'; el.dataset.index=idx; el.innerHTML = page.html;
        flipbookEl.appendChild(el);
      });
      bindPageEvents(); highlightCurrentPage();
    }
    function bindPageEvents(){
      flipbookEl.querySelectorAll('.word').forEach(w=>{
        w.addEventListener('click', ()=> showWordInfo(w.textContent.trim().toLowerCase()));
      });
      flipbookEl.querySelectorAll('.reveal-key').forEach(b=>{
        b.addEventListener('click', ()=>{
          const key = b.closest('.exercise-item').querySelector('.answer-key');
          key.classList.toggle('show');
        });
      });
      flipbookEl.querySelectorAll('.check-input').forEach(b=>{
        b.addEventListener('click', ()=>{
          const item = b.closest('.exercise-item');
          const input = item.querySelector('input, textarea, select');
          const key = (item.dataset.key||"").trim().toLowerCase();
          if(!input) return;
          const val = (input.value||"").trim().toLowerCase();
          if(val===key || key.includes(val)){ input.classList.add('correct'); input.classList.remove('incorrect'); }
          else{ input.classList.add('incorrect'); input.classList.remove('correct'); }
        });
      });
      flipbookEl.querySelectorAll('.listen-btn').forEach(btn=>{
        // audio element is adjacent; play directly
        const audio = btn.nextElementSibling;
        btn.addEventListener('click', ()=> audio && audio.play().catch(()=>{}));
      });
    }
    function highlightCurrentPage(){
      flipbookEl.querySelectorAll('.page').forEach((p,idx)=>{
        p.classList.remove('page-turn-enter','page-turn-leave');
        if(idx===currentPageIndex) p.classList.add('page-turn-enter'); else p.classList.add('page-turn-leave');
      });
    }
    function turnPage(dir){
      const next = currentPageIndex + dir; if(next<0 || next>=pages.length) return;
      currentPageIndex = next; highlightCurrentPage();
    }

    function sectionToPage(sec){
      const title = `<h2>${sec.title}</h2>`; let body = "";
      if(sec.type==="conversation" || sec.type==="findIt" || sec.type==="languageMelody"){
        if(sec.text){ body += `<div class="section"><h3>${sec.title}</h3><div class="text">${inlineWords(sec.text||"")}</div></div>`; }
        if(sec.lines){ body += `<div class="section"><h3>Conversation</h3><div class="text">${inlineWords(sec.lines.join("<br/>"))}</div></div>`; }
        if(sec.practice){ body += `<div class="section"><h3>Practice</h3><div class="text">${inlineWords(sec.practice.join("<br/>"))}</div></div>`; }
      }
      if(sec.type==="practice"){
        body += `<div class="section"><h3>${sec.title}</h3>${sec.items.map(it=>`
          <div class="exercise-item" data-key="${(it.a||'').toLowerCase()}">
            <div><b>Q:</b> ${inlineWords(it.q)}</div>
            <div class="exercise-controls">
              <input type="text" placeholder="Ù¾Ø§Ø³Ø® Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯"/>
              <button class="btn check-input">Ø¨Ø±Ø±Ø³ÛŒ</button>
              <button class="btn outline-btn reveal-key">Ù†Ù…Ø§ÛŒØ´ Ù¾Ø§Ø³Ø®</button>
            </div>
            <div class="answer-key"><b>Answer:</b> ${it.a}</div>
          </div>
        `).join("")}</div>`;
      }
      if(sec.type==="workbook"){
        body += `<div class="section"><h3>${sec.title}</h3>
          ${sec.items.map(it=>{
            if(it.type==="choice"){
              return `<div class="exercise-item" data-key="${(it.correct||'').toLowerCase()}">
                <div><b>${inlineWords(it.q)}</b></div>
                <div class="exercise-controls">
                  <select>${extractOptions(it.q).map(o=>`<option value="${o.toLowerCase()}">${o}</option>`).join("")}</select>
                  <button class="btn check-input">Ø¨Ø±Ø±Ø³ÛŒ</button>
                  <button class="btn outline-btn reveal-key">Ù†Ù…Ø§ÛŒØ´ Ù¾Ø§Ø³Ø®</button>
                </div>
                <div class="answer-key"><b>Answer:</b> ${it.correct}</div>
              </div>`;
            }
            if(it.type==="fill"){
              return `<div class="exercise-item" data-key="${(it.key||'').toLowerCase()}">
                <div><b>${inlineWords(it.q)}</b></div>
                <div class="exercise-controls">
                  <input type="text" placeholder="Ù¾Ø§Ø³Ø® Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯"/>
                  <button class="btn check-input">Ø¨Ø±Ø±Ø³ÛŒ</button>
                  <button class="btn outline-btn reveal-key">Ù†Ù…Ø§ÛŒØ´ Ù¾Ø§Ø³Ø®</button>
                </div>
                <div class="answer-key"><b>Answer:</b> ${it.key}</div>
              </div>`;
            }
            if(it.type==="unscramble"){
              return `<div class="exercise-item" data-key="${(it.key||'').toLowerCase()}">
                <div><b>Ø¨Ø§Ø²Ú†ÛŒÙ†ÛŒ:</b> ${inlineWords(it.q)}</div>
                <div class="exercise-controls">
                  <input type="text" placeholder="Ø¬Ù…Ù„Ù‡ ØµØ­ÛŒØ­ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯"/>
                  <button class="btn check-input">Ø¨Ø±Ø±Ø³ÛŒ</button>
                  <button class="btn outline-btn reveal-key">Ù†Ù…Ø§ÛŒØ´ Ù¾Ø§Ø³Ø®</button>
                </div>
                <div class="answer-key"><b>Answer:</b> ${it.key}</div>
              </div>`;
            }
            return "";
          }).join("")}
        </div>`;
      }
      if(sec.type==="grammar"){
        body += `<div class="section"><h3>${sec.title}</h3>
          ${sec.blocks.map(b=>`
            <div class="exercise-item">
              <div><b>${b.label}:</b> ${inlineWords(b.text)}</div>
              <div class="exercise-controls">
                <button class="btn outline-btn" onclick="alert('${escapeJs(b.text)}')">Ù†Ù…Ø§ÛŒØ´ ØªÙˆØ¶ÛŒØ­Ø§Øª</button>
              </div>
            </div>
          `).join("")}
        </div>`;
      }
      if(sec.type==="listeningCard"){
        body += `
          <div class="listening-card">
            <h2>ğŸ§ ${sec.title}</h2>
            <p class="listening-text">${nl2br(inlineWords(sec.text||""))}</p>
            <button class="listen-btn">â–¶ Ù¾Ø®Ø´ ØµÙˆØª</button>
            <audio src="${sec.audio}"></audio>
          </div>
        `;
      }
      if(sec.type==="photoDict"){
        body += `<div class="section"><h3>${sec.title}</h3>
          <div class="photo-dict-grid">
            ${sec.phrases.map(p=>`
              <div class="phrase-card">
                <div><b>${p.en}</b></div>
                <div class="muted">${p.fa}</div>
                <div class="phrase-actions">
                  <button class="btn small" onclick="pronounce('${sanitizeTTS(p.en)}')">ğŸ”Š ØªÙ„ÙØ¸</button>
                  <button class="btn small" onclick="alert('Example: ${escapeJs(p.ex)}\\nÙ…Ø«Ø§Ù„: ${escapeJs(p.fa)}')">Ù…Ø«Ø§Ù„</button>
                </div>
              </div>
            `).join("")}
          </div>
        </div>`;
      }
      return { html: `${title}${body}` };
    }

    function inlineWords(text){
      return String(text).replace(/\b([A-Za-z][A-Za-z\-']+)\b/g,(m)=>`<span class="word">${m}</span>`);
    }
    function nl2br(str){ return String(str).replace(/\n/g,"<br/>"); }
    function escapeJs(s){ return String(s).replace(/['"]/g,''); }
    function sanitizeTTS(s){ return String(s).replace(/[^\w\s\-']/g,''); }

    function showWordInfo(word){
      const info = window.DICT[word];
      popupWord.textContent = word;
      popupBody.innerHTML = info ? `
        <div class="row"><span class="label">Ù…Ø¹Ù†ÛŒ ÙØ§Ø±Ø³ÛŒ:</span> <span class="value">${info.fa}</span></div>
        <div class="row"><span class="label">Ù…ØªØ±Ø§Ø¯Ùâ€ŒÙ‡Ø§:</span> <span class="value">${(info.syn||[]).join(", ")}</span></div>
        <div class="row"><span class="label">Ú©Ù„Ù…Ø§Øª Ù…Ø±ØªØ¨Ø·:</span> <span class="value">${(info.rel||[]).join(", ")}</span></div>
        <div class="row"><span class="label">Ù…Ø«Ø§Ù„ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ:</span> <span class="value">${info.ex}</span></div>
        <div class="row"><span class="label">Ù…Ø¹Ù†Ø§ÛŒ Ø³Ø§Ø¯Ù‡:</span> <span class="value">Ø§ÛŒÙ† Ú©Ù„Ù…Ù‡ ÛŒØ¹Ù†ÛŒ "${info.fa}".</span></div>
      ` : `
        <div class="row"><span class="label">ÙˆØ§Ú˜Ù‡ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª:</span> <span class="value">Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ "${word}" Ø±Ø§ Ø¨Ù‡ DICT Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯.</span></div>
      `;
      wordPopup.classList.remove('hidden');
    }

    function pronounce(text){
      if(!window.speechSynthesis){ alert("Speech Synthesis Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯."); return; }
      const u = new SpeechSynthesisUtterance(text); u.lang = 'en-US'; window.speechSynthesis.speak(u);
    }

    function extractOptions(q){
      const m = q.match(/([A-Za-z']+)\s*\/\s*([A-Za-z']+)/);
      return m ? [m[1], m[2]] : ["Yes","No"];
    }

    // --- Exams rendering ---
    function openExam(key){
      const exam = window.EXAMS[key]; if(!exam){ alert("Exam not found."); return; }
      currentExam = exam; examTitle.textContent = exam.title;
      examBody.innerHTML = exam.questions.map((q,i)=>renderExamQuestion(q,i)).join("");
      examModal.classList.remove('hidden');
    }
    function renderExamQuestion(q, idx){
      if(q.type==="mc"){
        return `<div class="exam-question" data-index="${idx}" data-key="${(q.key||'').toLowerCase()}">
          <h4>Q${idx+1}. ${q.q}</h4>
          ${q.opts.map(o=>`
            <label style="display:block;margin:4px 0;">
              <input type="radio" name="q${idx}" value="${o.toLowerCase()}"/> ${o}
            </label>
          `).join("")}
        </div>`;
      }
      if(q.type==="fill"){
        return `<div class="exam-question" data-index="${idx}" data-key="${(q.key||'').toLowerCase()}">
          <h4>Q${idx+1}. ${q.q}</h4>
          <input type="text" placeholder="Ù¾Ø§Ø³Ø® Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯"/>
        </div>`;
      }
      if(q.type==="short"){
        return `<div class="exam-question" data-index="${idx}">
          <h4>Q${idx+1}. ${q.q}</h4>
          <textarea rows="3" placeholder="Ù¾Ø§Ø³Ø® ØªØ´Ø±ÛŒØ­ÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯"></textarea>
        </div>`;
      }
      if(q.type==="match"){
        return `<div class="exam-question" data-index="${idx}">
          <h4>Q${idx+1}. ${q.q}</h4>
          <div class="text">${q.pairs.map(p=>`<div>â€¢ ${p[0]} â€” ${p[1]}</div>`).join("")}</div>
        </div>`;
      }
      return "";
    }
    function gradeExam(){
      if(!currentExam) return;
      const questions = examBody.querySelectorAll('.exam-question');
      let score=0,total=0;
      questions.forEach(q=>{
        const key = (q.dataset.key||"").trim();
        const radios = q.querySelectorAll('input[type="radio"]');
        const input = q.querySelector('input[type="text"]');
        if(radios.length){
          total++;
          const chosen = [...radios].find(r=>r.checked);
          if(chosen && chosen.value===key){ score++; q.classList.add('correct'); } else{ q.classList.add('incorrect'); }
        }else if(input){
          total++;
          const val = (input.value||"").trim().toLowerCase();
          if(val===key){ score++; q.classList.add('correct'); } else{ q.classList.add('incorrect'); }
        }
      });
      alert(`Ù†Ù…Ø±Ù‡â€ŒÛŒ Ø¨Ø®Ø´ Ø®ÙˆØ¯Ú©Ø§Ø±: ${score} Ø§Ø² ${total}. Ø³ÙˆØ§Ù„Ø§Øª ØªØ´Ø±ÛŒØ­ÛŒ/ØªØ·Ø¨ÛŒÙ‚ÛŒ Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± ØªØµØ­ÛŒØ­ Ù†Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.`);
    }
    function showExamAnswers(){
      if(!currentExam) return;
      const questions = examBody.querySelectorAll('.exam-question');
      questions.forEach(q=>{
        const key = (q.dataset.key||"").trim();
        if(key){
          const ans = document.createElement('div');
          ans.style.marginTop='6px'; ans.style.color='#bde8ff'; ans.innerHTML=`<b>Answer:</b> ${key}`;
          q.appendChild(ans);
        }
      });
    }

    // --- Verbs rendering ---
    function renderVerbs(){
      verbsBody.innerHTML = window.IRREGULAR_VERBS.map(v=>`
        <div class="verb-card">
          <div class="verb-head">
            <div class="forms">${v.base} â†’ ${v.past}</div>
            <div class="actions">
              <button class="btn small" onclick="pronounce('${sanitizeTTS(v.base)}')">ğŸ”Š base</button>
              <button class="btn small" onclick="pronounce('${sanitizeTTS(v.past)}')">ğŸ”Š past</button>
            </div>
          </div>
          <div class="verb-ex">
            <div><b>Example (EN):</b> ${v.exEn}</div>
            <div><b>Ù…Ø«Ø§Ù„ (FA):</b> ${v.exFa}</div>
          </div>
        </div>
      `).join("");
    }
  </script>
</body>
</html>
